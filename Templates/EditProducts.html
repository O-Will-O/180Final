{% extends "base.html" %}
{% block body %}
<style>
  .Parent_Container {
    width: 100%;
    margin: auto;
    text-align: center;
    display: inline-grid;
    grid-template-columns: 22vw 22vw 22vw 22vw;
  }

  .Edit_Product_Container {
    width: fit-content;
    margin: auto;
  }

  .EP_Product {
    border: 3px solid #ccc;
    width: 300px;
    padding: 25px;
    margin-bottom: 20px;
    border-radius: 15px;
    background-color: #f9f9f9;
  }

  .EP_Item {
    margin: 5px 0;
    font-size: 14px;
  }

  .EP_Item strong {
    text-decoration: underline double;
  }

  .Item_title {
    font-size: 18px;
    width: fit-content;
    margin: auto;
  }

  .Item_desc {
    font-size: 11px;
    color: #555;
    line-height: 15px;
  }

  .Item_price,
  .Item_discount_amount {
    color: #007bff;
  }

  .Item_Discount_available_to {
    color: #dc3545;
  }

  .Item_buttons {
    margin: 15px auto;
    display: flex;
    justify-content: space-evenly;
  }

  .Item_buttons button,
  .Item_delete button {
    width: 125px;
    height: 38px;
    cursor: pointer;
    background-color: #aeaeae;
    border: 3px inset black;
    border-radius: 4px;
    transition: background-color 0.3s ease;
  }

  .Item_buttons button:hover,
  .Item_delete button:hover {
    background-color: #7a8eac;
    border: 3px outset black;
  }

  .Edit_Form_Container,
  .Discount_Form_Container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 999;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  #Edit_Form,
  #Discount_Form {
    background-color: #fff;
    padding: 20px;
    margin: 10px;
    border-radius: 10px;
    width: 30%;
    max-width: 100vw;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
  }

  .Edit_form_item,
  .Discount_form_item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
  }

  .Edit_form_item label,
  .Discount_form_item label {
    flex-basis: 30%;
    text-align: left;
    margin: auto;
  }

  .Edit_form_item input,
  .Edit_form_item textarea,
  .Discount_form_item input,
  .Discount_form_item textarea {
    flex-basis: 60%;
    margin: auto;
  }

  .Discount_form_item select {
    flex-basis: 61.4%;
    margin: auto;
  }

  .Item_buttons {
    margin-top: 20px;
    display: flex;
    justify-content: space-between;
  }

  .Item_buttons button {
    width: 48%;
    height: 38px;
    cursor: pointer;
    background-color: #aeaeae;
    border: 3px inset black;
    border-radius: 4px;
    transition: background-color 0.3s ease;
  }

  .Item_buttons button:hover {
    background-color: #7a8eac;
    border: 3px outset black;
  }
</style>
<h1 class="Product_title">Edit Products</h1>
<div class="Parent_Container">
  <div class="Edit_Product_Container">
    <div class="EP_Product">
      <p class="Item_title EP_Item"><strong>Product Name</strong></p>
      <p class="Item_PID EP_Item"><strong>PID:</strong> P1</p>
      <p class="Item_desc EP_Item"><strong>DESCRIPTION:</strong> THiS IS A Description OIFJF ODI JDFJ IOSDFJIO IJFDSO
        IJDSFJIJO ISD FOJIJ OISFDDSn ijsjdffoisdfj sdiof sosjf</p>
      <p class="Item_Warranty EP_Item"><strong>WARRANTY:</strong> 90 days</p>
      <p class="Item_stock EP_Item"><strong>STOCK:</strong> 9092</p>
      <p class="Item_price EP_Item"><strong>PRICE:</strong> $420.69</p>
      <p class="Item_AddedBy EP_Item"><strong>ADDED BY:</strong> VendorNULL</p>
      <p class="Item_discount_amount EP_Item"><strong>DISCOUNT AMOUNT:</strong> $69.99</p>
      <p class="Item_Discount_available_to EP_Item"><strong>DISCOUNT AVAILABLE TILL:</strong> 2026-12-25</p>
      <div class="Item_buttons">
        <button class="Item_Edit_Info">Edit Product Details</button>
        <button class="Item_Edit_Discount">Apply Product Discount</button>
      </div>
      <div class="Item_delete">
        <button class="Item_Edit_Delete">Delete Product</button>
      </div>
    </div>
  </div>
  <div class="Edit_Product_Container">
    <div class="EP_Product">
      <p class="Item_title EP_Item"><strong>Product Name2</strong></p>
      <p class="Item_PID EP_Item"><strong>PID:</strong> P2</p>
      <p class="Item_desc EP_Item"><strong>DESCRIPTION:</strong> THiS IS A Description OIFJF ODI JDFJ IOSDFJIO IJFDSO</p>
      <p class="Item_Warranty EP_Item"><strong>WARRANTY:</strong> 900 days</p>
      <p class="Item_stock EP_Item"><strong>STOCK:</strong> 43434</p>
      <p class="Item_price EP_Item"><strong>PRICE:</strong> $5463.76</p>
      <p class="Item_AddedBy EP_Item"><strong>ADDED BY:</strong> VendorNULLlllllll</p>
      <p class="Item_discount_amount EP_Item"><strong>DISCOUNT AMOUNT:</strong> $343434.34</p>
      <p class="Item_Discount_available_to EP_Item"><strong>DISCOUNT AVAILABLE TILL:</strong> 2111-12-01</p>
      <div class="Item_buttons">
        <button class="Item_Edit_Info">Edit Product Details</button>
        <button class="Item_Edit_Discount">Apply Product Discount</button>
      </div>
      <div class="Item_delete">
        <button class="Item_Edit_Delete">Delete Product</button>
      </div>
    </div>
  </div>
  <div class="Edit_Product_Container">
    <div class="EP_Product">
      <p class="Item_title EP_Item"><strong>Product Name2</strong></p>
      <p class="Item_PID EP_Item"><strong>PID:</strong> P2</p>
      <p class="Item_desc EP_Item"><strong>DESCRIPTION:</strong> THiS IS A Description OIFJF ODI JDFJ IOSDFJIO IJFDSO</p>
      <p class="Item_Warranty EP_Item"><strong>WARRANTY:</strong> 900 days</p>
      <p class="Item_stock EP_Item"><strong>STOCK:</strong> 43434</p>
      <p class="Item_price EP_Item"><strong>PRICE:</strong> $5463.76</p>
      <p class="Item_AddedBy EP_Item"><strong>ADDED BY:</strong> VendorNULLlllllll</p>
      <p class="Item_discount_amount EP_Item"><strong>DISCOUNT AMOUNT:</strong> NULL</p>
      <p class="Item_Discount_available_to EP_Item"><strong>DISCOUNT AVAILABLE TILL:</strong> NULL</p>
      <div class="Item_buttons">
        <button class="Item_Edit_Info">Edit Product Details</button>
        <button class="Item_Edit_Discount">Apply Product Discount</button>
      </div>
      <div class="Item_delete">
        <button class="Item_Edit_Delete">Delete Product</button>
      </div>
    </div>
  </div>
</div>
<!-- Hidden edit form -->
<!--  -->
<div class="Edit_Form_Container" style="display: none;">
  <form id="Edit_Form" class="EP_Product">
    <!-- Editable fields with labels -->
    <div class="Edit_form_item">
      <label for="ProductName">Product Name:</label>
      <input type="text" id="ProductName" placeholder="Product Name"><br>
    </div>
    <div class="Edit_form_item">
      <label for="ProductDescription">Description:</label>
      <textarea id="ProductDescription" cols="23" rows="3"></textarea>
      <br>
    </div>
    <div class="Edit_form_item">
      <label for="ProductWarranty">Warranty:</label>
      <input type="text" id="ProductWarranty" placeholder="Warranty"><br>
    </div>
    <div class="Edit_form_item">
      <label for="ProductStock">Stock:</label>
      <input type="number" id="ProductStock" placeholder="Stock"><br>
    </div>
    <div class="Edit_form_item">
      <label for="ProductPrice">Price:</label>
      <input type="number" id="ProductPrice" step='0.01' placeholder="Price"><br>
    </div>
    <div class="Edit_form_item">
      <label for="ProductAddedBy">Added By:</label>
      <input type="text" id="ProductAddedBy" placeholder="Added By" disabled><br>
    </div>
    <!-- Submit and cancel buttons -->
    <div class="Item_buttons">
      <button type="submit" class="Item_Edit_Submit">Save Changes</button>
      <button type="button" class="Item_Edit_Cancel">Cancel</button>
    </div>
  </form>
</div>

<style>


</style>

<!-- Hidden Discount form-->
<!--  -->
<div class="Discount_Form_Container" style="display: none;">
  <form id="Discount_Form" class="DP_Product">
      <div class="Discount_form_item">
        <label for="ProductID">Product ID</label>
        <input type="text" id="ProductID" placeholder="" disabled>
      </div>
      <div class="Discount_form_item">
        <label for="OriginalPrice">OriginalPrice</label>
        <input type="number" id="OriginalPrice" step='0.01' disabled>
      </div>
      <div class="Discount_form_item">
        <label for="SelectDiscount">Select Discount</label>
        <select id="SelectDiscount" onchange="DiscountChangeDisplay()">
          <option value=""></option>
          {% for discount in discounts %}
              <option value="{{discount}}">{{discount[0]}}, {{discount[1]}}, {{discount[2]}}</option>
          {% endfor %}
        </select>
      </div>

    <div class="Item_buttons">
      <button type="submit" class="Item_Discount_Submit">Save Changes</button>
      <button type="button" class="Item_Discount_Cancel">Cancel</button>
    </div>
  </form>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const editButtons = document.querySelectorAll('.Item_Edit_Info');
    const editFormContainer = document.querySelector('.Edit_Form_Container');
    const editForm = document.querySelector('#Edit_Form');
    const cancelButton = document.querySelector('.Item_Edit_Cancel');

    // Function to populate the edit form with product details
    function populateEditForm(productElement) {
      const productName = productElement.querySelector('.Item_title').innerText;
      const productDescription = productElement.querySelector('.Item_desc').innerText.split(':')[1].trim();
      const productWarranty = productElement.querySelector('.Item_Warranty').innerText.split(':')[1].trim();
      const productStock = productElement.querySelector('.Item_stock').innerText.split(':')[1].trim();
      const productPrice = productElement.querySelector('.Item_price').innerText.split('$')[1].trim();
      const productAddedBy = productElement.querySelector('.Item_AddedBy').innerText.split(':')[1].trim();

      // Populate the form fields with the extracted data
      editForm.querySelector('#ProductName').value = productName;
      editForm.querySelector('#ProductDescription').value = productDescription;
      editForm.querySelector('#ProductWarranty').value = productWarranty;
      editForm.querySelector('#ProductStock').value = productStock;
      editForm.querySelector('#ProductPrice').value = productPrice;
      editForm.querySelector('#ProductAddedBy').value = productAddedBy;
    }

    // Show edit form and populate it with data when edit button is clicked
    editButtons.forEach(function (editButton) {
      editButton.addEventListener('click', function () {
        const productParent = editButton.closest('.EP_Product');
        populateEditForm(productParent);
        editFormContainer.style.display = 'flex';
      });
    });

    // Hide edit form when cancel button is clicked
    cancelButton.addEventListener('click', function () {
      editFormContainer.style.display = 'none';
    });

    // Additional functionality such as form submission handling can be added here
  });

  document.addEventListener('DOMContentLoaded', function () {
    const discountButtons = document.querySelectorAll('.Item_Edit_Discount');
    const discountFormContainer = document.querySelector('.Discount_Form_Container');
    const discountForm = document.querySelector('#Discount_Form');
    const cancelDiscountButton = document.querySelector('.Item_Discount_Cancel');

    // Function to populate the discount form with product ID and original price
    function populateDiscountForm(productElement) {
      const productId = productElement.querySelector('.Item_PID').innerText.split(':')[1].trim();
      const originalPrice = productElement.querySelector('.Item_price').innerText.split('$')[1];

      // Populate the form fields with the extracted data
      discountForm.querySelector('#ProductID').value = productId;
      discountForm.querySelector('#OriginalPrice').value = originalPrice;
    }

    // Show discount form and populate it with data when discount button is clicked
    discountButtons.forEach(function (discountButton) {
      discountButton.addEventListener('click', function () {
        const productParent = discountButton.closest('.EP_Product');
        populateDiscountForm(productParent);
        discountFormContainer.style.display = 'flex';
      });
    });

    // Hide discount form when cancel button is clicked
    cancelDiscountButton.addEventListener('click', function () {
      discountFormContainer.style.display = 'none';
    });

    // Additional functionality such as form submission handling can be added here
  });


  function DiscountChangeDisplay() {
  // Remove existing div with ID "DiscountChange" if it exists
  const existingDiv = document.getElementById("DiscountChange");
  if (existingDiv) {
    existingDiv.remove();
  }

  let originalPrice = parseFloat(document.getElementById("OriginalPrice").value);
  console.log(originalPrice);
  let discount = document.getElementById("SelectDiscount").value;
  const regex = /'([^']*)', ([\d.]+), '([^']*)'/g;
  let match;

  while ((match = regex.exec(discount)) !== null) {
    var discountID = match[1];
    var discountAmount = parseFloat(match[2]);
    var discountTillDate = match[3];
  }

  let div = document.createElement("div");
  div.id = "DiscountChange";
  let innerDiv = `
    <div class="Discount_form_item">
      <label for="DiscountID">Discount ID</label>
      <input type="text" id="DiscountID" placeholder="" disabled value="${discountID}">
    </div>

    <div class="Discount_form_item">
      <label for="ChangedPrice">ChangedPrice</label>
      <input type="number" id="ChangedPrice" step='0.01' disabled value="${originalPrice - discountAmount}">
    </div>

    <div class="Discount_form_item">
      <label for="DateTill">DateTill</label>
      <input type="date" id="DateTill" placeholder="" disabled value="${discountTillDate}">
    </div>
  `;
  div.innerHTML = innerDiv;
  document.getElementById("Discount_Form").appendChild(div);
}

</script>



{% endblock %}